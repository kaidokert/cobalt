<!DOCTYPE html>
<html>
    <head>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/url-search-params/1.1.0/url-search-params.js"></script>
        <style>
            body {
                background-color: #fff;
            }
            .progress-container {
                width: 100%;
                height: 30px;
                background-color: #ddd;
                border-radius: 5px;
                box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            }
            .progress-bar {
                height: 100%;
                background-color: #4CAF50;
                border-radius: 5px;
                width: 0%;
                overflow:hidden;
                position: relative;
            }
            .progress-text {
                position: absolute;
                width: 100%;
                text-align: center;
                color:white;
                font-weight: bold;
            }
        </style>
    </head>
    <body>
        <div>
            <div class="progress-container">
                <div class="progress-bar"><span class="progress-text">number</span></div>
            </div>
        </div>
        <script>
            const fileSize = 500 * 1024 * 1024;
            function updateProgressBar(progress) {
                const progressBar = document.querySelector('.progress-bar');
                progressBar.style.width = progress + '%';
                const text = document.querySelector('.progress-text');
                text.textContent = parseInt(progress) + '%';
            }
            function downloadFileInChunks(url, chunkSize) {
                let start = 0;
                let end = chunkSize;

                const downloadChunk = (start, end) => {
                    const xhr = new XMLHttpRequest();
                    xhr.open('GET', url, true);
                    xhr.responseType = 'blob';
                    xhr.setRequestHeader('Range', `bytes=${start}-${end}`);

                    xhr.onload = () => {
                        if (xhr.status === 206) {
                            console.log(`Downloaded chunk: ${start} to ${end}`);

                            start = end + 1;
                            end = start + chunkSize;
                            updateProgressBar( start / fileSize * 100 );

                            if (start < fileSize) {
                                downloadChunk(start, Math.min(end, fileSize));
                            } else {
                                console.log('Download complete');
                            }
                        } else {
                            console.error('Error while downloading chunk:', xhr.statusText);
                        }
                    };

                    xhr.onerror = (error) => {
                        console.error('Network error while downloading chunk');
                        console.log(error);
                        console.log(error.type);
                    };

                    // Send the XHR request
                    xhr.send();
                };

                // Start downloading the first chunk
                downloadChunk(start, end);
            }
            function downloadDemo() {
                const urlSearchParams = new URLSearchParams(window.location.search);
                const params = Object.fromEntries(urlSearchParams.entries());
                const chunkSize = ( params.chunkSize || 1024 ) * 1024;
                const quic = params.quic || 1;
                if (window.h5vcc && window.h5vcc.settings) {
                    console.log(`setting quic to ${quic}`);
                    h5vcc.settings.set('QUIC', quic);
                }
                const url = "https://rr1---sn-n4v7sney.googlevideo.com/videoplayback?expire=1723096630&ei=1gm0ZtTQCeK8sfIP_6iuoQg&ip=2620%3A0%3A1006%3A111%3Abaa5%3A2d9%3Ab926%3A8fda&id=o-AEa2KbLZsJDVAXeIqswiazXBavMYIay1GluIhkVniW8x&itag=701&source=youtube&requiressl=yes&xpc=EgVo2aDSNQ%3D%3D&mh=NH&mm=31%2C29&mn=sn-n4v7sney%2Csn-o097znsl&ms=au%2Crdu&mv=m&mvi=1&pl=48&initcwndbps=1136250&vprv=1&svpuc=1&mime=video%2Fmp4&rqh=1&gir=yes&clen=983516450&dur=313.780&lmt=1711470628780415&mt=1723074540&fvip=3&keepalive=yes&c=IOS&txp=4502434&sparams=expire%2Cei%2Cip%2Cid%2Citag%2Csource%2Crequiressl%2Cxpc%2Cvprv%2Csvpuc%2Cmime%2Crqh%2Cgir%2Cclen%2Cdur%2Clmt&sig=AJfQdSswRQIgAZkJx-8edm8KxBLRNkyXnyXt6nNviAX1gKXMT6rEaDUCIQCg_5LtCWI2oP1OkkIp-bWEEmJhmS3H8E9OksStxy_LUw%3D%3D&lsparams=mh%2Cmm%2Cmn%2Cms%2Cmv%2Cmvi%2Cpl%2Cinitcwndbps&lsig=AGtxev0wRAIgZ98aT_5AkLjL_yyNfeuEtmgK_RQudeOfWVj0Ac0F9iwCIDEq9900jtaOfHiv2Ro5y3TAuQIbRRFPrtu-3L79OhVf";
                window.setTimeout(() => {
                    downloadFileInChunks(url, chunkSize);
                },500);
            }
            window.setTimeout(() => {
                downloadDemo()
            },500);
        </script>
    </body>
</html>
